<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACCOUNT module - Gu√≠a de Historias de Usuario</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f7fa;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 3rem 2rem;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }
        .header p {
            font-size: 1.1rem;
            opacity: 0.95;
        }
        .section {
            background: white;
            margin: 20px 0;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
        .section h2 {
            color: #667eea;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 1.6rem;
        }
        .section p {
            margin-bottom: 1rem;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .card {
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            padding: 20px;
            background: #f8f9fa;
        }
        .card h3 {
            color: #667eea;
            margin-bottom: 10px;
        }
        .card p {
            margin-bottom: 0.5rem;
        }
        .card ul {
            list-style: none;
            padding-left: 0;
            margin-top: 0.5rem;
        }
        .card ul li {
            margin-bottom: 0.4rem;
            padding-left: 1rem;
            position: relative;
        }
        .card ul li::before {
            content: "‚Ä¢";
            position: absolute;
            left: 0;
            color: #667eea;
        }
        .actors-grid .card {
            background: #f0f4ff;
            border-color: #ccd7ff;
        }
        .actors-grid .card h3 {
            font-size: 1.2rem;
        }
        .tech-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1rem;
        }
        .tech-item {
            padding: 1rem;
            background: #f5f7fa;
            border-radius: 6px;
            border-left: 3px solid #667eea;
        }
        .tech-item strong {
            color: #667eea;
            display: block;
            margin-bottom: 0.3rem;
        }
        ul.inline-list {
            list-style: none;
            padding: 0;
            display: flex;
            flex-wrap: wrap;
            gap: 0.6rem;
            margin-bottom: 1rem;
        }
        ul.inline-list li {
            background: #e3edf7;
            border-radius: 20px;
            padding: 6px 14px;
            font-size: 0.9rem;
            color: #1c4f91;
            font-weight: 600;
        }
        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.9em;
            margin-bottom: 1rem;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #667eea;
            color: white;
        }
        .complexity-badge {
            display: inline-block;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            margin: 5px 5px 0 0;
        }
        .simple { background: #d4edda; color: #155724; }
        .medium { background: #fff3cd; color: #856404; }
        .complex { background: #f8d7da; color: #721c24; }
        .rule {
            background: #e3f2fd;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #2196f3;
            border-radius: 4px;
        }
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1rem;
        }
        .metrics-card {
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            padding: 15px;
            background: #fdfdfd;
        }
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            background: white;
            border-radius: 8px;
        }
        footer a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }
        footer a:hover {
            text-decoration: underline;
        }
        @media (max-width: 768px) {
            .header h1 { font-size: 2rem; }
            .grid { grid-template-columns: 1fr; }
            .tech-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <header class="header">
        <h1>üí≥ ACCOUNT - M√≥dulo de Cuentas</h1>
        <p>Sistema de Consulta y Actualizaci√≥n de Cuentas para CardDemo</p>
        <p style="margin-top: 10px; font-size: 1rem;">
            Consulta y gesti√≥n del ciclo de vida financiero de cada cuenta con validaci√≥n inline, mascaramiento de datos sensibles y auditor√≠a operativa.
        </p>
        <p style="margin-top: 10px; font-size: 0.95rem;">
            <a href="../../../modules/account/account-overview.md" style="color:#fff; font-weight:600;">Leer la documentaci√≥n t√©cnica completa (Markdown)</a>
        </p>
    </header>

    <div class="container">
        <section class="section">
            <h2>üìã Resumen del m√≥dulo</h2>
            <p>El m√≥dulo permite b√∫squedas r√°pidas por Account ID (11 d√≠gitos) y actualizaciones controladas. La interfaz combina tarjetas MUI, validaciones locales y llamadas REST normalizadas por `apiClient`. La p√°gina de consulta respeta el enmascaramiento de SSN/n√∫mero de tarjeta y muestra chips de estado, mientras que la p√°gina de actualizaci√≥n dispone de un modo edit y confirmaci√≥n.</p>
            <ul class="inline-list">
                <li>Responsable: Back-office</li>
                <li>Tecnolog√≠a: React 18 + TypeScript</li>
                <li>UI Library: MUI 5</li>
                <li>APIs: `/account-view`, `/accounts/{id}`</li>
                <li>Autenticaci√≥n: Auth Module</li>
            </ul>
        </section>

        <section class="section">
            <h2>üéØ Gu√≠a de desarrollo de historias</h2>
            <div class="grid">
                <div class="card">
                    <h3>Visualizaci√≥n de cuentas</h3>
                    <p><strong>Template:</strong> Como representante de servicio, quiero buscar una cuenta por ID para ver saldo, ciclo actual y estatus en tiempo real.</p>
                    <p>Accept:</p>
                    <ul>
                        <li>Account ID validado (11 d√≠gitos / no ceros).</li>
                        <li>Chips activos/inactivos con color l√≥gico.</li>
                        <li>Show Sensitive Data controlado por toggle.</li>
                    </ul>
                </div>
                <div class="card">
                    <h3>Actualizaci√≥n transaccional</h3>
                    <p><strong>Template:</strong> Como administrador, quiero editar l√≠mites y datos de contacto para reflejar cambios regulatorios.</p>
                    <p>Accept:</p>
                    <ul>
                        <li>Modo edit habilitado solo tras b√∫squeda exitosa.</li>
                        <li>Validaciones de ZIP, FICO y active status.</li>
                        <li>Confirm dialog antes del PUT.</li>
                    </ul>
                </div>
                <div class="card">
                    <h3>Seguridad & validaciones</h3>
                    <p><strong>Template:</strong> Como oficial de cumplimiento, quiero que se enmascaren datos sensibles y se registre qui√©n los revela.</p>
                    <p>Accept:</p>
                    <ul>
                        <li>Show Sensitive Data alterna `formatSSN` y `formatCardNumber`.</li>
                        <li>F5 guarda solo con cambios detectados (`hasChanges`).</li>
                        <li>F3/Escape cierra el flujo.</li>
                    </ul>
                </div>
            </div>

            <h3>‚ö° Factores de aceleraci√≥n</h3>
            <ul>
                <li>Hooks (`useAccountView`, `useAccountUpdate`) comparten l√≥gica de loading/errores.</li>
                <li>Tarjetas con `Stack + Card` para secciones replicables.</li>
                <li>MSW con cuentas mock y validaciones listos para QA.</li>
                <li>`LoadingSpinner` + `SystemHeader` listos para cualquier m√≥dulo transaccional.</li>
            </ul>

            <h3>üìä Gu√≠a de complejidades</h3>
            <div>
                <span class="complexity-badge simple">Simple (1-2 pts)</span>
                <span class="complexity-badge medium">Medio (3-5 pts)</span>
                <span class="complexity-badge complex">Complejo (5-8 pts)</span>
            </div>
            <ul>
                <li><strong>Simple:</strong> Agregar un campo de solo lectura o un mensaje adicional.</li>
                <li><strong>Medio:</strong> Validaci√≥n nueva (ZIP, FICO) y hooking de `useAccountUpdate`.</li>
                <li><strong>Complejo:</strong> Integraci√≥n con scoring externo y auditor√≠a de cambios.</li>
            </ul>
        </section>

        <section class="section actors-grid">
            <h2>üßë‚Äçüíº Actores y viajes</h2>
            <div class="grid">
                <div class="card">
                    <h3>Back-office Agent</h3>
                    <p>Busca cuentas de clientes, valida el status y responde consultas en < 500ms.</p>
                    <p>Viaje:</p>
                    <ul>
                        <li>Abre el m√≥dulo ‚Üí ingresa ID ‚Üí recibe tarjeta con saldo y grupo.</li>
                        <li>Muestra alertas si `errorMessage` o `inputValid=false`.</li>
                        <li>Puede activar test accounts (DEV) o salir con F3/Escape.</li>
                    </ul>
                </div>
                <div class="card">
                    <h3>Administrador</h3>
                    <p>Actualiza l√≠mites y datos personales con validaciones estrictas antes de persistir.</p>
                    <p>Viaje:</p>
                    <ul>
                        <li>Busca la cuenta ‚Üí activa edi mode ‚Üí modifica valores.</li>
                        <li>Confirma con di√°logo y observa mensajes `success`/`error` del backend.</li>
                        <li>F5 guarda, F12 resetea, F3 cierra.</li>
                    </ul>
                </div>
                <div class="card">
                    <h3>Oficial de Cumplimiento</h3>
                    <p>Verifica enmascaramiento, reglas de FICO y trazabilidad de cambios.</p>
                    <p>Viaje:</p>
                    <ul>
                        <li>Revisa que SSN y tarjetas est√©n enmascarados.</li>
                        <li>Solicita auditor√≠a (pendiente) para flujos de actualizaci√≥n.</li>
                        <li>Reporta errores de validaci√≥n presentados por MSW o backend.</li>
                    </ul>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>üîß Fundaci√≥n t√©cnica</h2>
            <div class="grid">
                <div class="card">
                    <h3>AccountViewScreen.tsx</h3>
                    <p>Layout con formulario de b√∫squeda, tarjetas informativas, chips de estado y el toggle de datos sensibles.</p>
                </div>
                <div class="card">
                    <h3>AccountUpdateScreen.tsx</h3>
                    <p>Formulario dividido en secciones (account, financial, customer) con confirm dialog y detecci√≥n de cambios.</p>
                </div>
                <div class="card">
                    <h3>useAccountView</h3>
                    <p>Hook basado en `useMutation` que normaliza GET `/api/account-view` y `/api/account-view/initialize`.</p>
                </div>
                <div class="card">
                    <h3>useAccountUpdate</h3>
                    <p>Gestiona `GET /api/accounts/{id}` y `PUT /api/accounts/{id}`, expone `hasChanges`, `resetForm` y `updateLocalData`.</p>
                </div>
            </div>

            <h3>üîó Dependencias</h3>
            <ul>
                <li>**MUI 5:** TextField, Button, Card, Stack, Alert.</li>
                <li>**React Router:** Rutas protegidas por `ProtectedRoute` antes de llegar a Account.</li>
                <li>**Redux Toolkit:** Opcional para estado global pero `useMutation` ya encapsula el flujo.</li>
                <li>**apiClient / useMutation:** A√±aden Authorization desde `localStorage` y manejan errores/timeouts.</li>
                <li>**Auth Module:** Debe proporcionar JWT para que `apiClient` inserte el header.</li>
            </ul>

            <h3>üåê Interfaces p√∫blicas</h3>
            <pre><code>GET  /api/account-view?accountId={id}            ‚Üí Search account + customer + cards (response: AccountViewResponse)</code></pre>
            <pre><code>GET  /api/account-view/initialize              ‚Üí Inicializa pantalla con metadata (transactionId, programName)</code></pre>
            <pre><code>GET  /api/accounts/{accountId}                ‚Üí Datos para formulario de edici√≥n (AccountUpdateData)</code></pre>
            <pre><code>PUT  /api/accounts/{accountId}                ‚Üí Actualizaci√≥n transaccional con validaciones (devuelve ApiResponse)</code></pre>

            <h3>üìä Modelos de datos</h3>
            <pre><code>interface AccountUpdateData {
  accountId: number;
  activeStatus: 'Y' | 'N';
  creditLimit: number;
  balance: number;
  groupId: string;
  firstName: string;
  lastName: string;
  zipCode: string;
  ficoScore: number;
  ssn: string;
}</code></pre>
        </section>

        <section class="section">
            <h2>üìã Reglas de negocio</h2>
            <div class="rule">
                <strong>RN-001:</strong> Account ID es obligatorio, 11 d√≠gitos y no puede ser todo ceros.
            </div>
            <div class="rule">
                <strong>RN-002:</strong> Status solo puede ser 'Y' (activo) o 'N' (inactivo); los inactivos no pueden generar transacciones.
            </div>
            <div class="rule">
                <strong>RN-003:</strong> El cr√©dito disponible se muestra como `creditLimit - currentBalance` y se colorea rojo/verde.
            </div>
            <div class="rule">
                <strong>RN-004:</strong> SSN y n√∫mero de tarjeta se enmascaran salvo que el usuario habilite expl√≠citamente `Show Sensitive Data`.
            </div>
            <div class="rule">
                <strong>RN-005:</strong> Actualizaci√≥n es at√≥mica; ZIP, FICO y active status se validan antes del `PUT`.
            </div>
            <div class="rule">
                <strong>RN-006:</strong> La pantalla valida que la b√∫squeda recorra `CardXref`, `Account` y `Customer`; si algo falta, se muestra "Account not found in Cross ref file".
            </div>
        </section>

        <section class="section">
            <h2>üéØ Patrones de criterios de aceptaci√≥n</h2>
            <div class="grid">
                <div class="card">
                    <h3>Autenticaci√≥n</h3>
                    <p><strong>Dado</strong> token v√°lido<br>
                       <strong>Cuando</strong> ingreso al m√≥dulo<br>
                       <strong>Entonces</strong> puedo buscar cuentas sin redirecciones.</p>
                </div>
                <div class="card">
                    <h3>Validaci√≥n</h3>
                    <p><strong>Dado</strong> ingreso Account ID<br>
                       <strong>Cuando</strong> no tiene 11 d√≠gitos<br>
                       <strong>Entonces</strong> aparece error "Account number must be a non zero 11 digit number".</p>
                </div>
                <div class="card">
                    <h3>Rendimiento</h3>
                    <p><strong>Dado</strong> busco una cuenta existente<br>
                       <strong>Cuando</strong> el backend responde<br>
                       <strong>Entonces</strong> la vista completa carga en < 500ms (P95).</p>
                </div>
                <div class="card">
                    <h3>Manejo de errores</h3>
                    <p><strong>Dado</strong> que la cuenta no existe<br>
                       <strong>Cuando</strong> la API responde con 404<br>
                       <strong>Entonces</strong> se muestra alert con "Account not found in Cross ref file" y el formulario se limpia.</p>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>‚ö° Presupuestos y m√©tricas</h2>
            <div class="metrics-grid">
                <div class="metrics-card">
                    <p><strong>Tiempo de respuesta</strong></p>
                    <p>API de b√∫squeda < 500ms (P95). Actualizaciones < 1200ms por mock.</p>
                </div>
                <div class="metrics-card">
                    <p><strong>Capacidad</strong></p>
                    <p>Soporta 100 b√∫squedas concurrentes por segundo sin degradar UI (objetivo).</p>
                </div>
                <div class="metrics-card">
                    <p><strong>Uso de memoria</strong></p>
                    <p>Menos de 50MB por pesta√±a; los datos permanecen en estado local.</p>
                </div>
                <div class="metrics-card">
                    <p><strong>M√©trica funcional</strong></p>
                    <p>0% de errores de validaci√≥n no controlados y quick-win en < 5 minutos por incidencia.</p>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>üö® Riesgos y mitigaciones</h2>
            <div class="grid">
                <div class="card">
                    <h3>Performance en b√∫squeda</h3>
                    <p>La b√∫squeda recorre tres tablas; sin √≠ndices, el tiempo crece con datos.</p>
                    <p><strong>Mitigaci√≥n:</strong> A√±adir √≠ndices y considerar cach√© en Redis para cuentas frecuentes.</p>
                </div>
                <div class="card">
                    <h3>Falta de i18n</h3>
                    <p>Mensajes hardcodeados en ingl√©s.</p>
                    <p><strong>Mitigaci√≥n:</strong> Implementar `react-i18next` antes de nuevas historias multi-idioma.</p>
                </div>
                <div class="card">
                    <h3>Sin auditor√≠a de cambios</h3>
                    <p>No hay trazabilidad de qui√©n actualiza qu√© valores.</p>
                    <p><strong>Mitigaci√≥n:</strong> Planear Audit Trail con tables audit (Spring Data Envers) o historial propio.</p>
                </div>
                <div class="card">
                    <h3>Validaciones heredadas</h3>
                    <p>Validaciones COBOL est√°n comentadas en el c√≥digo migrado.</p>
                    <p><strong>Mitigaci√≥n:</strong> Reescribir validaciones con regex modernas y flujos de validaci√≥n centralizada.</p>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>üß™ Testing y mocking</h2>
            <p>Se usa MSW con handlers `app/mocks/accountHandlers.ts` y `app/mocks/accountUpdateHandlers.ts`, que incluyen cuentas preconfiguradas (11111111111-99999999999), delays de 800/1200ms y validaciones para ZIP, FICO, active status y existence.</p>
            <p>Los handlers devuelven `infoMessage` y `errorMessage` que la UI consume para mostrar alerts, lo que facilita pruebas end-to-end sin backend.</p>
        </section>

        <section class="section">
            <h2>üìö Ejemplos de c√≥digo reales</h2>
            <h3>useAccountView.ts</h3>
            <pre><code>const response = await apiClient.get<AccountViewResponse>(
  `/account-view?accountId=${accountId.toString().padStart(11, '0')}`
);
setData(response);</code></pre>
            <h3>useAccountUpdate.ts</h3>
            <pre><code>const response = await apiClient.put<AccountUpdateResponse>(
  `/accounts/${data.accountId}`,
  data
);
if (response.success && response.data) {
  setAccountData(response.data);
  setHasChanges(false);
}</code></pre>
        </section>

        <section class="section">
            <h2>üìä Tabla de validaciones</h2>
            <table>
                <thead>
                    <tr>
                        <th>Campo</th>
                        <th>Validaci√≥n</th>
                        <th>Regla</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>Account ID</td><td><code>^\d{11}$</code></td><td>11 d√≠gitos, no cero</td></tr>
                    <tr><td>Status</td><td>Dropdown</td><td>Y (Activo) o N (Inactivo)</td></tr>
                    <tr><td>Credit Limit</td><td>Num√©rico</td><td>Positivo, obligatorio</td></tr>
                    <tr><td>FICO Score</td><td>300-850</td><td>Rango est√°ndar industria</td></tr>
                    <tr><td>ZIP Code</td><td><code>^\d{5}(-\d{4})?$</code></td><td>Formato US ZIP</td></tr>
                    <tr><td>State</td><td>Alfab√©tico</td><td>2 caracteres</td></tr>
                    <tr><td>First/Last Name</td><td>Alfab√©tico</td><td>Solo letras, obligatorio</td></tr>
                    <tr><td>SSN</td><td>Enmascarado</td><td>***-**-XXXX en vista</td></tr>
                </tbody>
            </table>
        </section>
    </div>

    <footer>
        <p><a href="../../index.html">‚Üê Volver al √≠ndice de m√≥dulos</a></p>
        <p><a href="../../../system-overview.md">üè† Volver al System Overview</a></p>
        <p><a href="../../../modules/account/account-overview.md">üìÑ Ver el overview Markdown del m√≥dulo</a></p>
        <p style="color: #666; margin-top: 15px;"><em>√öltima actualizaci√≥n: 2026-01-30 | Precisi√≥n del m√≥dulo: 95%</em></p>
    </footer>
</body>
</html>
